<!DOCTYPE html> <html lang="en-US"> <head> <meta charset="UTF-8"> <meta http-equiv="X-UA-Compatible" content="IE=Edge"> <title>Metrics - Soda Documentation</title> <link rel="shortcut icon" href="/soda-sql/favicon.ico" type="image/x-icon"> <link rel="stylesheet" href="/soda-sql/assets/css/just-the-docs-default.css"> <script type="text/javascript" src="/soda-sql/assets/js/vendor/lunr.min.js"></script> <script type="text/javascript" src="/soda-sql/assets/js/just-the-docs.js"></script> <meta name="viewport" content="width=device-width, initial-scale=1"> <!-- Begin Jekyll SEO tag v2.7.1 --> <title>Metrics | Soda Documentation</title> <meta name="generator" content="Jekyll v4.2.0" /> <meta property="og:title" content="Metrics" /> <meta property="og:locale" content="en_US" /> <meta name="description" content="Learn how to use Soda to test and monitor data quality." /> <meta property="og:description" content="Learn how to use Soda to test and monitor data quality." /> <link rel="canonical" href="/soda-sql/documentation/sql_metrics.html" /> <meta property="og:url" content="/soda-sql/documentation/sql_metrics.html" /> <meta property="og:site_name" content="Soda Documentation" /> <meta name="twitter:card" content="summary" /> <meta property="twitter:title" content="Metrics" /> <script type="application/ld+json"> {"url":"/soda-sql/documentation/sql_metrics.html","publisher":{"@type":"Organization","logo":{"@type":"ImageObject","url":"/soda-sql/assets/images/soda-logo.svg"}},"description":"Learn how to use Soda to test and monitor data quality.","@type":"WebPage","headline":"Metrics","@context":"https://schema.org"}</script> <!-- End Jekyll SEO tag --> </head> <body> <svg xmlns="http://www.w3.org/2000/svg" style="display: none;"> <symbol id="svg-link" viewBox="0 0 24 24"> <title>Link</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-link"> <path d="M10 13a5 5 0 0 0 7.54.54l3-3a5 5 0 0 0-7.07-7.07l-1.72 1.71"></path><path d="M14 11a5 5 0 0 0-7.54-.54l-3 3a5 5 0 0 0 7.07 7.07l1.71-1.71"></path> </svg> </symbol> <symbol id="svg-search" viewBox="0 0 24 24"> <title>Search</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-search"> <circle cx="11" cy="11" r="8"></circle><line x1="21" y1="21" x2="16.65" y2="16.65"></line> </svg> </symbol> <symbol id="svg-menu" viewBox="0 0 24 24"> <title>Menu</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-menu"> <line x1="3" y1="12" x2="21" y2="12"></line><line x1="3" y1="6" x2="21" y2="6"></line><line x1="3" y1="18" x2="21" y2="18"></line> </svg> </symbol> <symbol id="svg-arrow-right" viewBox="0 0 24 24"> <title>Expand</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-chevron-right"> <polyline points="9 18 15 12 9 6"></polyline> </svg> </symbol> <symbol id="svg-doc" viewBox="0 0 24 24"> <title>Document</title> <svg xmlns="http://www.w3.org/2000/svg" width="24" height="24" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round" class="feather feather-file"> <path d="M13 2H6a2 2 0 0 0-2 2v16a2 2 0 0 0 2 2h12a2 2 0 0 0 2-2V9z"></path><polyline points="13 2 13 9 20 9"></polyline> </svg> </symbol> </svg> <div class="side-bar"> <div class="site-header"> <a href="/soda-sql/" class="site-title lh-tight"> <div class="site-logo"></div> </a> <a href="#" id="menu-button" class="site-button"> <svg viewBox="0 0 24 24" class="icon"><use xlink:href="#svg-menu"></use></svg> </a> </div> <nav role="navigation" aria-label="Main" id="site-nav" class="site-nav"> <ul class="nav-list"> <li class="nav-list-item "> <a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"> <use xlink:href="#svg-arrow-right"></use> </svg></a> <a class="nav-list-link" href="/soda-sql/getting-started/5_min_tutorial.html">Get Started</a> <ul class="nav-list "> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/getting-started/5_min_tutorial.html">Quick start tutorial</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/getting-started/installation.html">Install Soda SQL</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/getting-started/configure.html">Configure Soda SQL</a> </li> </ul> </li> <li class="nav-list-item active"> <a href="#" class="nav-list-expander"><svg viewBox="0 0 24 24"> <use xlink:href="#svg-arrow-right"></use> </svg></a> <a class="nav-list-link" href="/soda-sql/documentation/concepts.html">Documentation</a> <ul class="nav-list "> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/documentation/concepts.html">How Soda SQL works</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/documentation/cli.html">Soda SQL CLI commands</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/documentation/warehouse.html">Warehouse YAML</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/documentation/warehouse_types.html">Set warehouse configuration</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/documentation/scan.html">Scan YAML</a> </li> <li class="nav-list-item"> <a class="nav-list-link active" href="/soda-sql/documentation/sql_metrics.html">Metrics</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/documentation/tests.html">Tests</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/documentation/filtering.html">Apply filters</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/documentation/programmatic_scan.html">Configure programmatic scans</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/documentation/orchestrate_scans.html">Configure orchestrated scans</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/documentation/soda-cloud-architecture.html">Soda Cloud Architecture</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/documentation/connect_to_cloud.html">Connect to Soda Cloud</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/documentation/monitors.html">Create monitors and alerts</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/documentation/integrate-slack.html">Integrate with Slack</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/documentation/troubleshoot.html">Troubleshoot</a> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/documentation/glossary.html">Glossary</a> </li> </ul> </li> <li class="nav-list-item"> <a class="nav-list-link " href="/soda-sql/community.html">Community</a> </li> </ul> </nav> <footer class="site-footer"> This site uses <a href="https://github.com/pmarsceill/just-the-docs">Just the Docs</a>, a documentation theme for Jekyll. </footer> </div> <div class="main" id="top"> <div id="main-header" class="main-header"> <div class="search"> <div class="search-input-wrap"> <input type="text" id="search-input" class="search-input" tabindex="0" placeholder="Search Soda Documentation" aria-label="Search Soda Documentation" autocomplete="off"> <label for="search-input" class="search-label"><svg viewBox="0 0 24 24" class="search-icon"><use xlink:href="#svg-search"></use></svg></label> </div> <div id="search-results" class="search-results"></div> </div> <nav aria-label="Auxiliary" class="aux-nav"> <ul class="aux-nav-list"> <li class="aux-nav-list-item"> <a href="//github.com/sodadata/soda-sql" class="site-button" > Soda SQL on GitHub </a> </li> </ul> </nav> </div> <div id="main-content-wrap" class="main-content-wrap"> <nav aria-label="Breadcrumb" class="breadcrumb-nav"> <ol class="breadcrumb-nav-list"> <li class="breadcrumb-nav-list-item"><a href="">Documentation</a></li> <li class="breadcrumb-nav-list-item"><span>Metrics</span></li> </ol> </nav> <div id="main-content" class="main-content" role="main"> <h1 id="metrics"> <a href="#metrics" class="anchor-heading" aria-labelledby="metrics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Metrics </h1> <p>A <strong>metric</strong> is a property of the data in your database. A <strong>measurement</strong> is the value for a metric that Soda SQL obtains during a scan. For example, in <code class="language-plaintext highlighter-rouge">row_count = 5</code>, <code class="language-plaintext highlighter-rouge">row_count</code> is the metric and <code class="language-plaintext highlighter-rouge">5</code> is the measurement. The following sections detail the configuration for metrics you can customize in your <a href="/soda-sql/documentation/scan.html">scan YAML file</a>. <br /> <br /></p> <p><strong><a href="#table-metrics">Table metrics</a><br /> <a href="#column-metrics">Column metrics</a><br /> <a href="#sql-metrics">SQL metrics</a><br /></strong></p> <h2 id="table-metrics"> <a href="#table-metrics" class="anchor-heading" aria-labelledby="table-metrics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Table metrics </h2> <p>Use <strong>table metrics</strong> to define tests in your scan YAML file that apply to all data in the table during a scan.</p> <p><img src="../assets/images/table-metrics.png" alt="table-metrics" height="440px" width="440px" /></p> <div class="table-wrapper"><table> <thead> <tr> <th>Table metric</th> <th>Description</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">row_count</code></td> <td>The total number of rows in a table.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">schema</code></td> <td>Identifies that the table is part of a schema.</td> </tr> </tbody> </table></div> <h4 id="example-tests-using-a-table-metric"> <a href="#example-tests-using-a-table-metric" class="anchor-heading" aria-labelledby="example-tests-using-a-table-metric"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example tests using a table metric </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">tests</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">row_count &gt; </span><span class="m">0</span>
</code></pre></div></div> <p>Checks to see if the table has more than one row. The test passes if the table contains rows.</p> <p><br /></p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">tests</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="s">row_count =5</span>
</code></pre></div></div> <p>Checks to see if the table has exactly five rows. The test fails if the table contains more or fewer than five rows.</p> <h2 id="column-metrics"> <a href="#column-metrics" class="anchor-heading" aria-labelledby="column-metrics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Column metrics </h2> <p>Use <strong>column metrics</strong> to define tests in your scan YAML file that apply to specific columns in a table during a scan.</p> <p>Where a column metric references a valid or invalid value, or a limit, use the metric in conjunction with a <strong>column configuration</strong>. A Soda SQL scan uses the value of a column configuration key to determine if it should pass or fail a test. See <a href="#example-test-using-a-column-metric">example</a> below.</p> <p><img src="../assets/images/column-metrics.png" alt="column-metrics" height="440px" width="440px" /></p> <div class="table-wrapper"><table> <thead> <tr> <th>Column metric</th> <th>Description</th> <th>Use with column config key(s)</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">avg</code></td> <td>The average of the values in a numeric column.</td> <td>-</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">avg_length</code></td> <td>The average length of a string.</td> <td>-</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">distinct</code></td> <td>The distinct contents in rows in a column.</td> <td>-</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">duplicate_count</code></td> <td>The number of rows that contain duplicated content.</td> <td>-</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">frequent_values</code></td> <td>The number of rows that contain content that most frequently occurs in the column.</td> <td>-</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">histogram</code></td> <td>A histogram calculated on the content of the column.</td> <td>-</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">invalid_count</code></td> <td>The total number of rows that contain invalid content.</td> <td><code class="language-plaintext highlighter-rouge">valid_format</code> <br /> <code class="language-plaintext highlighter-rouge">valid_regex</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">invalid_percentage</code></td> <td>The total percentage of rows that contain invalid content.</td> <td><code class="language-plaintext highlighter-rouge">valid_format</code> <br /> <code class="language-plaintext highlighter-rouge">valid_regex</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">max</code></td> <td>The greatest value in a numeric column.</td> <td>-</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">max_length</code></td> <td>The maximum length of a string.</td> <td><code class="language-plaintext highlighter-rouge">valid_max_length</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">maxs</code></td> <td>The number of rows that qualify as maximum.</td> <td><code class="language-plaintext highlighter-rouge">valid_max</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">min</code></td> <td>The smallest value in a numeric column.</td> <td>-</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">min_length</code></td> <td>The minimum length of a string.</td> <td><code class="language-plaintext highlighter-rouge">valid_min_length</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">mins</code></td> <td>The number of rows that qualify as minimum.</td> <td><code class="language-plaintext highlighter-rouge">valid_min</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">missing_count</code></td> <td>The total number of rows that are missing specific content.</td> <td><code class="language-plaintext highlighter-rouge">missing_values</code> <br /> <code class="language-plaintext highlighter-rouge">missing_regex</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">missing_percentage</code></td> <td>The total percentage of rows that are missing specific content.</td> <td><code class="language-plaintext highlighter-rouge">missing_values</code> <br /> <code class="language-plaintext highlighter-rouge">missing_regex</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">stddev</code></td> <td>The standard deviation of a numeric column.</td> <td>-</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">sum</code></td> <td>The sum of the values in a numeric column.</td> <td>-</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">unique_count</code></td> <td>The number of rows in which the content appears only once in the column.</td> <td>-</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">uniqueness</code></td> <td>A ratio that produces a number between 0 and 100 that indicates how unique a column is. 0 indicates that all the values are the same; 100 indicates that all the values in the the column are unique.</td> <td>-</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">valid_count</code></td> <td>The total number of rows that contain valid content.</td> <td><code class="language-plaintext highlighter-rouge">valid_format</code> <br /> <code class="language-plaintext highlighter-rouge">valid_regex</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">valid_percentage</code></td> <td>The total percentage of rows that contain valid content.</td> <td><code class="language-plaintext highlighter-rouge">valid_format</code> <br /> <code class="language-plaintext highlighter-rouge">valid_regex</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">values_count</code></td> <td>The total number of rows that contain content included in a list of valid values.</td> <td><code class="language-plaintext highlighter-rouge">valid_values</code> <br /> <code class="language-plaintext highlighter-rouge">valid_regex</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">values_percentage</code></td> <td>The total percentage of rows that contain content included in a list of valid values.</td> <td><code class="language-plaintext highlighter-rouge">valid_values</code> <br /> <code class="language-plaintext highlighter-rouge">valid_regex</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">variance</code></td> <td>The variance of a numerical column.</td> <td>-</td> </tr> </tbody> </table></div> <div class="table-wrapper"><table> <thead> <tr> <th>Column configuration key</th> <th>Description</th> <th>Values</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">metric_groups</code></td> <td>Specifies pre-defined groups of metrics that Soda SQL computes for this column. See <a href="#metric-groups-and-dependencies">Metric groups and dependencies</a> for details.</td> <td><code class="language-plaintext highlighter-rouge">duplicates</code> <br /> <code class="language-plaintext highlighter-rouge">length</code> <br /> <code class="language-plaintext highlighter-rouge">missing</code> <br /> <code class="language-plaintext highlighter-rouge">profiling</code> <br /> <code class="language-plaintext highlighter-rouge">statistics</code> <br /> <code class="language-plaintext highlighter-rouge">validity</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">metrics</code></td> <td>Specifies extra metrics that Soda SQL computes for this column.</td> <td>-</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">missing_format</code></td> <td>Specifies missing values such as whitespace or empty strings.</td> <td> </td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">missing_regex</code></td> <td>Use regex expressions to specify your own custom missing values.</td> <td>regex</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">missing_values</code></td> <td>Specifies the values that Soda SQL is to consider missing in list format.</td> <td>integers in list</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">tests</code></td> <td>A section that contains the tests that Soda SQL runs on a column during a scan.</td> <td>-</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">valid_format</code></td> <td>Specifies a named valid text format.</td> <td>See Valid_format value table below.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">valid_max</code></td> <td>Specifies a maximum value for valid values.</td> <td>integer</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">valid_max_length</code></td> <td>Specifies a maximum string length for valid values.</td> <td>integer</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">valid_min</code></td> <td>Specifies a minimum value for valid values.</td> <td>integer</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">valid_min_length</code></td> <td>Specifies a minimum string length for valid values.</td> <td>integer</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">valid_regex</code></td> <td>Use regex expressions to specify your own custom valid values.</td> <td>regex</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">valid_values</code></td> <td>Specifies several valid values in list format.</td> <td>integers in list</td> </tr> </tbody> </table></div> <blockquote> <p>EXPERIMENTAL: The valid_format values are experimental and may change in the future.</p> </blockquote> <div class="table-wrapper"><table> <thead> <tr> <th><code class="language-plaintext highlighter-rouge">valid_format</code> value</th> <th>Format</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">number_whole</code></td> <td>Number is whole.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">number_decimal_point</code></td> <td>Number uses <code class="language-plaintext highlighter-rouge">.</code> as decimal indicator.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">number_decimal_comma</code></td> <td>Number uses <code class="language-plaintext highlighter-rouge">,</code> as decimal indicator.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">number_percentage</code></td> <td>Number is a percentage.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">number_money_usd</code></td> <td>Number matches US dollar currency pattern.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">number_money_eur</code></td> <td>Number matches Euro currency pattern.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">number_money_gbp</code></td> <td>Number matches British pound currency pattern.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">number_money_rmb</code></td> <td>Number matches Renminbi yuan currency pattern.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">number_money_chf</code></td> <td>Number matches Swiss franc currency pattern.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">number_money</code></td> <td>Format matches any of the <code class="language-plaintext highlighter-rouge">number_money_</code> patterns.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">date_eu</code></td> <td>dd/mm/yyyy</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">date_us</code></td> <td>mm/dd/yyyy</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">date_inverse</code></td> <td>yyyy/mm/dd</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">time</code></td> <td> </td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">date_iso_8601</code></td> <td>yyyy-mm-dd</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">uuid</code></td> <td>universally unique identifier</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">ip_address</code></td> <td>Four whole numbers separated by <code class="language-plaintext highlighter-rouge">.</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">email</code></td> <td>email address</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">phone_number</code></td> <td> </td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">credit_card_number</code></td> <td>Four four-digit numbers separated by spaces.</td> </tr> </tbody> </table></div> <h4 id="example-tests-using-a-column-metric"> <a href="#example-tests-using-a-column-metric" class="anchor-heading" aria-labelledby="example-tests-using-a-column-metric"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Example tests using a column metric </h4> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">columns</span><span class="pi">:</span>
  <span class="na">id</span><span class="pi">:</span>
    <span class="na">valid_format</span><span class="pi">:</span> <span class="s">uuid</span>
    <span class="na">tests</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">invalid_percentage == </span><span class="m">0</span>
  <span class="na">feepct</span><span class="pi">:</span>
    <span class="na">valid_format</span><span class="pi">:</span> <span class="s">number_percentage</span>
    <span class="na">tests</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="s">invalid_percentage == </span><span class="m">0</span>
</code></pre></div></div> <p><code class="language-plaintext highlighter-rouge">invalid_percentage == 0</code> in column <code class="language-plaintext highlighter-rouge">id</code> with column configuration <code class="language-plaintext highlighter-rouge">valid_format: uuid</code> checks the rows in the column named <code class="language-plaintext highlighter-rouge">id</code> for values that match a uuid (universally unique identifier) format. If the test passes, it means that 0% of the rows contain data that is invalid; if the test fails, it means that more than 0% of the rows contain invalid data, which is data that is in non-UUID format.</p> <h2 id="metric-groups-and-dependencies"> <a href="#metric-groups-and-dependencies" class="anchor-heading" aria-labelledby="metric-groups-and-dependencies"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Metric groups and dependencies </h2> <p>Out of the box, Soda SQL includes a <strong>metric groups</strong> configuration key. Define this configuration key in your scan YAML file so that when you use one of the group’s metrics in a test, Soda SQL automatically runs the test against all the metrics in its group.</p> <p>In the example below, a Soda SQL scan runs a test on the contents of the <code class="language-plaintext highlighter-rouge">commission</code> column to look for values that are not in percentage format. Because the YAML file also defined <code class="language-plaintext highlighter-rouge">metric_group: validity</code>, the scan also tests all other metrics in the <code class="language-plaintext highlighter-rouge">validity</code> group. Refer to table, below.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">columns</span><span class="pi">:</span>
  <span class="na">commission</span><span class="pi">:</span>
     <span class="na">metric_group</span><span class="pi">:</span> <span class="s">validity</span>
     <span class="na">valid_format</span><span class="pi">:</span> <span class="s">number_percentage</span>
     <span class="na">tests</span><span class="pi">:</span>
     <span class="s">– invalid_count == </span><span class="m">0</span>
</code></pre></div></div> <div class="table-wrapper"><table> <thead> <tr> <th><code class="language-plaintext highlighter-rouge">metric_groups</code> value</th> <th>Metrics the scan includes</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">all</code></td> <td>all column metrics</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">missing</code></td> <td><code class="language-plaintext highlighter-rouge">missing_count</code>, <code class="language-plaintext highlighter-rouge">missing_percentage</code>, <code class="language-plaintext highlighter-rouge">values_count</code>, <code class="language-plaintext highlighter-rouge">values_percentage</code>.</td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">validity</code></td> <td><code class="language-plaintext highlighter-rouge">valid_count</code>, <code class="language-plaintext highlighter-rouge">valid_percentage</code>, <code class="language-plaintext highlighter-rouge">invalid_count</code>, <code class="language-plaintext highlighter-rouge">invalide_percentage</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">duplicates</code></td> <td><code class="language-plaintext highlighter-rouge">distinct</code>, <code class="language-plaintext highlighter-rouge">unique_count</code>, <code class="language-plaintext highlighter-rouge">uniqueness</code>, <code class="language-plaintext highlighter-rouge">duplicate_count</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">length</code></td> <td><code class="language-plaintext highlighter-rouge">min_length</code>, <code class="language-plaintext highlighter-rouge">max_length</code>, <code class="language-plaintext highlighter-rouge">avg_length</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">profiling</code></td> <td><code class="language-plaintext highlighter-rouge">maxs</code>, <code class="language-plaintext highlighter-rouge">mins</code>, <code class="language-plaintext highlighter-rouge">frequent_values</code>, <code class="language-plaintext highlighter-rouge">histogram</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">statistics</code></td> <td><code class="language-plaintext highlighter-rouge">min</code>, <code class="language-plaintext highlighter-rouge">max</code>, <code class="language-plaintext highlighter-rouge">avg sum</code>, <code class="language-plaintext highlighter-rouge">variance</code>, <code class="language-plaintext highlighter-rouge">stddev</code></td> </tr> </tbody> </table></div> <p>By default, there exist <strong>dependencies</strong> between some metrics. If Soda SQL scans a metric which has dependencies, it includes all the dependent metrics in the scan as well.</p> <div class="table-wrapper"><table> <thead> <tr> <th>If you use…</th> <th>…the scan includes:</th> </tr> </thead> <tbody> <tr> <td><code class="language-plaintext highlighter-rouge">valid_count</code></td> <td><code class="language-plaintext highlighter-rouge">missing_count</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">valid_percentage</code></td> <td><code class="language-plaintext highlighter-rouge">missing_percentage</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">invalid_count</code></td> <td><code class="language-plaintext highlighter-rouge">values_count</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">invalid_percentage</code></td> <td><code class="language-plaintext highlighter-rouge">values_percentage</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">missing_count</code> <br /> <code class="language-plaintext highlighter-rouge">missing_percentage</code> <br /> <code class="language-plaintext highlighter-rouge">values_count</code> <br /> <code class="language-plaintext highlighter-rouge">values_percentage</code></td> <td><code class="language-plaintext highlighter-rouge">row_count</code></td> </tr> <tr> <td><code class="language-plaintext highlighter-rouge">histogram</code></td> <td><code class="language-plaintext highlighter-rouge">min</code> <br /> <code class="language-plaintext highlighter-rouge">max</code></td> </tr> </tbody> </table></div> <h2 id="sql-metrics"> <a href="#sql-metrics" class="anchor-heading" aria-labelledby="sql-metrics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SQL metrics </h2> <p>If the default set of table and column metrics that Soda SQL offers do not quite give you the information you need from a scan, you can use <strong>SQL metrics</strong> to customize your queries. SQL metrics essentially enable you to add SQL queries to your scan YAML file so that Soda SQL runs them during a scan.</p> <h4 id="simple-example"> <a href="#simple-example" class="anchor-heading" aria-labelledby="simple-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Simple example </h4> <p>In your scan YAML file, use the <code class="language-plaintext highlighter-rouge">sql_metrics</code> property as a table metric or a column metric. The following simple SQL metric example queries all content in the table to select a single numeric value.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">table_name</span><span class="pi">:</span> <span class="s">mytable</span>
<span class="na">sql_metrics</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">sql</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">SELECT sum(volume) as total_volume_us</span>
        <span class="s">FROM CUSTOMER_TRANSACTIONS</span>
        <span class="s">WHERE country = 'US'</span>
      <span class="na">tests</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">total_volume_us &gt; </span><span class="m">5000</span>
</code></pre></div></div> <p>In the example, the computed value (the sum volume of all customer transaction in the United States) becomes a <strong>field</strong> named <code class="language-plaintext highlighter-rouge">total_volume_us</code>, which, in turn, becomes the name of the metric that you use to define the test Soda SQL that runs on your data. In this case, the test passes if the computed sum of all US transactions exceeds <code class="language-plaintext highlighter-rouge">5000</code>.</p> <p>Notice that by default, Soda SQL uses the name of the field as the name of the metric. If you do not want to specify field names inside your SQL queries, you can explicitly name the metrics outside the queries. See <a href="#sql-metric-names">SQL metric names</a> below.</p> <h4 id="multiple-example"> <a href="#multiple-example" class="anchor-heading" aria-labelledby="multiple-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Multiple example </h4> <p>You can also compute multiple metric values in a single query, then combine them in your tests.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">table_name</span><span class="pi">:</span> <span class="s">mytable</span>
<span class="na">sql_metrics</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">sql</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">SELECT sum(volume) as total_volume_us,</span>
               <span class="s">min(volume) as min_volume_us,</span>
               <span class="s">max(volume) as max_volume_us</span>
        <span class="s">FROM CUSTOMER_TRANSACTIONS</span>
        <span class="s">WHERE country = 'US'</span>
      <span class="na">tests</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">total_volume_us &gt; </span><span class="m">5000</span>
        <span class="pi">-</span> <span class="s">min_volume_us &gt; </span><span class="m">20</span>
        <span class="pi">-</span> <span class="s">max_volume_us &gt; </span><span class="m">100</span>
        <span class="pi">-</span> <span class="s">max_volume_us - min_volume_us &lt; </span><span class="m">60</span>
</code></pre></div></div> <p>In this example, the tests pass if:</p> <ul> <li>the computed sum of all US transactions exceeds <code class="language-plaintext highlighter-rouge">5000</code></li> <li>the numerical value of the smallest of all US transactions is greater than <code class="language-plaintext highlighter-rouge">20</code></li> <li>the numerical value of the greatest of all US transactions is greater than <code class="language-plaintext highlighter-rouge">100</code></li> <li>the numerical value of the difference between the greatest and smallest of US transactions is less than <code class="language-plaintext highlighter-rouge">60</code></li> </ul> <h4 id="column-sql-metric-example"> <a href="#column-sql-metric-example" class="anchor-heading" aria-labelledby="column-sql-metric-example"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Column SQL metric example </h4> <p>The following example uses SQL metrics to run a query against an individual column named <code class="language-plaintext highlighter-rouge">volume</code>. When you use SQL metrics in a column, the field you define becomes available to use as a metric in the tests in that column.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">table_name</span><span class="pi">:</span> <span class="s">mytable</span>
<span class="na">columns</span><span class="pi">:</span>
    <span class="na">metrics</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">avg</span>
    <span class="na">volume</span><span class="pi">:</span>
        <span class="na">sql_metrics</span><span class="pi">:</span>
            <span class="pi">-</span> <span class="na">sql</span><span class="pi">:</span> <span class="pi">|</span>
                <span class="s">SELECT sum(volume) as total_volume_us</span>
                <span class="s">FROM CUSTOMER_TRANSACTIONS</span>
                <span class="s">WHERE country = 'US'</span>
              <span class="na">tests</span><span class="pi">:</span>
                <span class="pi">-</span> <span class="s">total_volume_us - avg &gt; </span><span class="m">5000</span>
</code></pre></div></div> <h3 id="sql-metric-names"> <a href="#sql-metric-names" class="anchor-heading" aria-labelledby="sql-metric-names"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SQL metric names </h3> <p>If you do not want to specify field names inside your SQL queries, you can use the <strong><code class="language-plaintext highlighter-rouge">metric_names</code> property</strong> to explicitly name the metrics outside the queries. This property contains a list of values which match the order of values in your <code class="language-plaintext highlighter-rouge">SELECT</code> statement.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">table_name</span><span class="pi">:</span> <span class="s">mytable</span>
<span class="na">sql_metrics</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">sql</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">SELECT sum(volume),</span>
               <span class="s">min(volume),</span>
               <span class="s">max(volume)</span>
        <span class="s">FROM CUSTOMER_TRANSACTIONS</span>
        <span class="s">WHERE country = 'US'</span>
      <span class="na">metric_names</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">total_volume_us</span>
        <span class="pi">-</span> <span class="s">min_volume_us</span>
        <span class="pi">-</span> <span class="s">max_volume_us</span>
      <span class="na">tests</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">total_volume_us &gt; </span><span class="m">5000</span>
        <span class="pi">-</span> <span class="s">min_volume_us &gt; </span><span class="m">20</span>
        <span class="pi">-</span> <span class="s">max_volume_us &gt; </span><span class="m">100</span>
        <span class="pi">-</span> <span class="s">max_volume_us - min_volume_us &lt; </span><span class="m">60</span>
</code></pre></div></div> <h3 id="group-by-queries-in-sql-metrics"> <a href="#group-by-queries-in-sql-metrics" class="anchor-heading" aria-labelledby="group-by-queries-in-sql-metrics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> GROUP BY queries in SQL metrics </h3> <p>If your SQL query uses a <code class="language-plaintext highlighter-rouge">GROUP BY</code> clause, you can use a <strong><code class="language-plaintext highlighter-rouge">group_by</code></strong> property in your SQL metrics to instruct Soda SQL to run each test against each group combination. Set the <code class="language-plaintext highlighter-rouge">group_property</code> as in the example below.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">table_name</span><span class="pi">:</span> <span class="s">mytable</span>
<span class="na">sql_metrics</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">sql</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">SELECT country,</span>
               <span class="s">sum(volume) as total_volume,</span>
               <span class="s">min(volume) as min_volume,</span>
               <span class="s">max(volume) as max_volume</span>
        <span class="s">FROM CUSTOMER_TRANSACTIONS</span>
        <span class="s">GROUP BY country</span>
      <span class="na">group_fields</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">country</span>
      <span class="na">tests</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">total_volume &gt; </span><span class="m">5000</span>
        <span class="pi">-</span> <span class="s">min_volume &gt; </span><span class="m">20</span>
        <span class="pi">-</span> <span class="s">max_volume &gt; </span><span class="m">100</span>
        <span class="pi">-</span> <span class="s">max_volume - min_volume &lt; </span><span class="m">60</span>
</code></pre></div></div> <h3 id="variables-in-sql-metrics"> <a href="#variables-in-sql-metrics" class="anchor-heading" aria-labelledby="variables-in-sql-metrics"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Variables in SQL metrics </h3> <p>In Soda SQL, you set a <strong>variable</strong> to apply a filter to the data that Soda SQL scans. Often you use a variable to filter the range of a scan by date. Refer to <a href="/soda-sql/documentation/filtering.html">Apply filters</a> for details.</p> <p>When you define a variable in your scan YAML file, Soda SQL applies the filter to all tests <em>except</em> tests defined in SQL metrics. To apply a filter to SQL metrics tests, be sure to explicitly define the variable in your SQL query, as in the example below.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">table_name</span><span class="pi">:</span> <span class="s">mytable</span>
<span class="na">filter</span><span class="pi">:</span> <span class="s">date = DATE ''</span>
<span class="na">sql_metrics</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">sql</span><span class="pi">:</span> <span class="pi">|</span>
        <span class="s">SELECT sum(volume) as total_volume_us</span>
        <span class="s">FROM CUSTOMER_TRANSACTIONS</span>
        <span class="s">WHERE country = 'US' AND date = DATE ''</span>
      <span class="na">tests</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">total_volume_us &gt; </span><span class="m">5000</span>
</code></pre></div></div> <h3 id="sql-metrics-using-file-reference"> <a href="#sql-metrics-using-file-reference" class="anchor-heading" aria-labelledby="sql-metrics-using-file-reference"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> SQL metrics using file reference </h3> <p>Instead of including all your customized SQL queries in the SQL metrics in your scan YAML file, you can use <strong><code class="language-plaintext highlighter-rouge">sql_file</code></strong> to reference a relative file.</p> <div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="na">table_name</span><span class="pi">:</span> <span class="s">mytable</span>
<span class="na">sql_metrics</span><span class="pi">:</span>
    <span class="pi">-</span> <span class="na">sql_file</span><span class="pi">:</span> <span class="s">mytable_metric_us_volume.sql</span>
      <span class="na">tests</span><span class="pi">:</span>
        <span class="pi">-</span> <span class="s">total_volume_us &gt; </span><span class="m">5000</span>
</code></pre></div></div> <p>In this case, the <code class="language-plaintext highlighter-rouge">mytable_metric_us_volume.sql</code> file contains the following SQL query.</p> <div class="language-sql highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="k">SELECT</span> <span class="k">sum</span><span class="p">(</span><span class="n">volume</span><span class="p">)</span> <span class="k">as</span> <span class="n">total_volume_us</span>
<span class="k">FROM</span> <span class="n">CUSTOMER_TRANSACTIONS</span>
<span class="k">WHERE</span> <span class="n">country</span> <span class="o">=</span> <span class="s1">'US'</span>
</code></pre></div></div> <h2 id="go-further"> <a href="#go-further" class="anchor-heading" aria-labelledby="go-further"><svg viewBox="0 0 16 16" aria-hidden="true"><use xlink:href="#svg-link"></use></svg></a> Go further </h2> <ul> <li>Learn <a href="/soda-sql/documentation/concepts.html">How Soda SQL works</a>.</li> <li>Learn more about the <a href="/soda-sql/documentation/scan.html">Scan YAML</a> file.</li> <li>Learn more about configuring <a href="/soda-sql/documentation/tests.html">tests</a>.</li> <li>Learn how to apply <a href="/soda-sql/documentation/filtering.html">filters</a> to your scan.</li> </ul> </div> </div> <div class="search-overlay"></div> </div> </body> </html>
